#include <intrinsic.h>
#include <stdint.h>
#include <string.h>
#define WIDTH 192
#define HEIGHT 128
#define FRAME_DELAY 5000

typedef uint8_t DISPLAY[HEIGHT][WIDTH];
volatile DISPLAY *display = (DISPLAY *)0x4000;

// Function to draw a character at (x, y) using 8x8 pixel font
// Dummy 8x8 font table: only handles space and uppercase letters A-Z
const uint8_t font8x8_basic[27][8] = {
    // Space ' '
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
    // 'A'
    {0x18, 0x24, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00},
    // 'B'
    {0x7C, 0x42, 0x42, 0x7C, 0x42, 0x42, 0x7C, 0x00},
    // 'C'
    {0x3C, 0x42, 0x40, 0x40, 0x40, 0x42, 0x3C, 0x00},
    // 'D'
    {0x78, 0x44, 0x42, 0x42, 0x42, 0x44, 0x78, 0x00},
    // 'E'
    {0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x7E, 0x00},
    // 'F'
    {0x7E, 0x40, 0x40, 0x7C, 0x40, 0x40, 0x40, 0x00},
    // 'G'
    {0x3C, 0x42, 0x40, 0x4E, 0x42, 0x42, 0x3C, 0x00},
    // 'H'
    {0x42, 0x42, 0x42, 0x7E, 0x42, 0x42, 0x42, 0x00},
    // 'I'
    {0x3C, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C, 0x00},
    // 'J'
    {0x1E, 0x08, 0x08, 0x08, 0x08, 0x48, 0x30, 0x00},
    // 'K'
    {0x42, 0x44, 0x48, 0x70, 0x48, 0x44, 0x42, 0x00},
    // 'L'
    {0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x7E, 0x00},
    // 'M'
    {0x42, 0x66, 0x5A, 0x5A, 0x42, 0x42, 0x42, 0x00},
    // 'N'
    {0x42, 0x62, 0x52, 0x4A, 0x46, 0x42, 0x42, 0x00},
    // 'O'
    {0x3C, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00},
    // 'P'
    {0x7C, 0x42, 0x42, 0x7C, 0x40, 0x40, 0x40, 0x00},
    // 'Q'
    {0x3C, 0x42, 0x42, 0x42, 0x4A, 0x44, 0x3A, 0x00},
    // 'R'
    {0x7C, 0x42, 0x42, 0x7C, 0x48, 0x44, 0x42, 0x00},
    // 'S'
    {0x3C, 0x42, 0x40, 0x3C, 0x02, 0x42, 0x3C, 0x00},
    // 'T'
    {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00},
    // 'U'
    {0x42, 0x42, 0x42, 0x42, 0x42, 0x42, 0x3C, 0x00},
    // 'V'
    {0x42, 0x42, 0x42, 0x42, 0x42, 0x24, 0x18, 0x00},
    // 'W'
    {0x42, 0x42, 0x42, 0x5A, 0x5A, 0x66, 0x42, 0x00},
    // 'X'
    {0x42, 0x42, 0x24, 0x18, 0x24, 0x42, 0x42, 0x00},
    // 'Y'
    {0x42, 0x42, 0x42, 0x24, 0x18, 0x18, 0x18, 0x00},
    // 'Z'
    {0x7E, 0x02, 0x04, 0x08, 0x10, 0x20, 0x7E, 0x00}};

void draw_char(uint16_t x, uint16_t y, char c, uint8_t color) {
  uint8_t index;
  if (c == ' ')
    index = 0;
  else if (c >= 'A' && c <= 'Z')
    index = c - 'A' + 1;
  else
    return; // ignore unsupported chars

  for (uint8_t row = 0; row < 8; row++) {
    uint8_t bits = font8x8_basic[index][row];
    for (uint8_t col = 0; col < 8; col++) {
      if (bits & (1 << (7 - col))) {
        (*display)[y + row][x + col] = color;
      }
    }
  }
}

void draw_text(uint16_t x, uint16_t y, const char *text, uint8_t color) {
  while (*text) {
    if (*text == '\n') {
      y += 8;
      x = 0;
    } else {
      draw_char(x, y, *text, color);
      x += 8;
    }
    text++;
  }
}

int main(void) {
  const uint8_t bg_color = 0x8a;

  // Clear screen
  for (uint16_t y = 0; y < HEIGHT; y++) {
    for (uint16_t x = 0; x < WIDTH; x++) {
      (*display)[y][x] = bg_color;
    }
  }

  // Draw the three requested lines
  const uint8_t text_color = 0x3d;
  draw_text(3, 8, "UNIVERSITATEA", text_color);
  draw_text(3, 24, "POLITEHNICA", text_color);
  draw_text(3, 40, "BUCURESTI", text_color);
  text_color = 0xbc;
  draw_text(140, 8, "CENTRU", text_color);
  draw_text(100, 24, "UNIVERSITAR", text_color);
  draw_text(132, 40, "PITESTI", text_color);
  text_color = 0x9a;
  draw_text(3, 85, "POPESCU", text_color);
  draw_text(3, 101, "IONUT ALEXANDRU", text_color);

  intrinsic_halt();

  return 0;
}
